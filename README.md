# 本地生活Agent - 美团核心本地商业CEO

与美团核心本地商业CEO对话，获取专业的战略建议和业务洞察。

## 🌐 在线体验

**访问地址：** https://wsj414855138-code.github.io/local-life-agent/

## ✨ 功能特性

- **智能问答** - 基于Gemini API的AI对话，提供专业CEO视角建议
- **图片理解** - 支持上传图片或粘贴截图，AI能理解图片内容并结合文字回答 🆕
- **结构化输出** - 金字塔原理思维框架，多种报告模板（PR/FAQ、WHY-WHAT-HOW、研报型等）
- **AI配图** - 自动生成报告配图（Gemini 3 Pro Image）
- **历史记录** - 保存对话历史，随时回顾
- **追问评论** - 选中报告文本添加追问，获取深度解答（支持附图）
- **日/夜间模式** - 支持主题切换
- **响应式设计** - 自适应手机/平板/桌面

## 🛠️ 技术栈

- **前端**: HTML + CSS + JavaScript
- **AI**: Google Gemini API (REST, Multimodal)
- **Markdown**: marked.js
- **代码高亮**: highlight.js
- **存储**: IndexedDB + localStorage

## 📁 项目结构

```
local-life-agent/
├── index.html    # 主页面
├── styles.css    # 样式文件（含响应式）
├── app.js        # 核心逻辑
└── README.md     # 项目说明
```

## 🚀 本地运行

1. 直接用浏览器打开 `index.html`
2. 点击右上角设置⚙️，输入你的 Gemini API Key
3. 开始对话！

## 📝 API Key 获取

1. 访问 [Google AI Studio](https://aistudio.google.com/)
2. 登录Google账号
3. 创建API Key

## 🔄 更新部署

修改代码后，将文件上传到GitHub仓库，GitHub Pages会自动更新。

## 📅 开发记录

### 2025-12-26 问题修复
- **"其他"选项输入修复** - 修复问卷"其他"选项无法自定义输入的问题
- **配图质量优化** - 升级图片生成 Prompt，要求 4K 高清、扁平插图风格、美团设计规范
- **评论回复截断修复** - 增加 Flash 模型 token 限制(500→2000)，优化 Prompt 确保完整回答
- **PDF导出优化** - 简化图片验证逻辑，保留有效图片，只移除失败/加载中的图片
- **报告后隐藏输入框** - 报告生成完成后自动隐藏底部输入框，点击"新话题"按钮才显示
- **禁止JSON输出** - Phase 2 明确禁止输出 JSON 格式，避免报告中出现乱码
- **时效性信息增强** - 动态注入当前日期到系统提示，确保 AI 基于最新市场情况回答

### 2025-12-24 AI 智能增强
- **多问题类型扩展** - CEO Prompt 支持汇报型/调研型/管理型/科普型/创意型五种问题类型
- **问题类型自适应输出** - 根据识别的问题类型生成不同结构的报告框架
- **智能分级评论回复** - 评论追问默认用 Flash 模型快速回答(50-100字)
- **深入了解按钮** - 点击后使用 Pro 模型生成详尽、专业的深度分析
- **JSON格式规范化** - 强制追问选项使用中文，key为字母(A/B/C)，禁止英文单词
- **错误处理优化** - 图片生成使用 Promise.allSettled 避免单个失败阻塞流程

### 2025-12-23 图片输入功能
- **图片上传** - 主输入框支持上传图片，类似千问的交互设计
- **剪贴板粘贴** - 支持 Ctrl+V 直接粘贴截图
- **多图支持** - 单次最多上传10张图片（单张≤7MB）
- **图片预览** - 上传后显示缩略图，支持删除和放大查看
- **追问附图** - 评论追问时也可附带图片
- **Gemini Vision** - 调用 Gemini 多模态能力理解图片内容
- **ImageManager 类** - 统一管理图片上传、预览、编码
- **输出统计** - 报告和评论回复末尾显示思考时间和字数统计

### 2025-12-21 智能优化版本
- **升级Gemini 3模型** - 使用最新gemini-3-pro-preview和gemini-3-flash-preview
- **Pro优先策略** - 默认使用Pro模型，只有极简单问题(复杂度≤3)才用Flash
- **泛化用户身份** - 支持所有本地生活业务，不再限定到店餐饮
- **移动端划线评论** - 修复手机端无法选择文字评论的问题
- **CEO融合式输出** - 不再机械标注"XX视角"，自然融合多角色视角
- **Prompt优化：汇报级思考助手** - 新增WHY思考框架、Benchmark对标分析
- **问题类型智能判断** - 探索型/执行型/决策型/诊断型，灵活匹配输出
- **一句话汇报版** - 每个报告都有30秒电梯演讲版本
- **报告反馈机制** - 👍👎按钮收集反馈，存储本地
- **代码清理** - 删除无用的Anthropic SDK引用
- **PDF导出修复** - 修复图片显示bug，自动隐藏加载失败的图片

### 2025-12 初始版本
- 实现基础对话功能
- 添加历史记录和追问评论
- UI升级：日夜间模式、响应式设计
- AI配图功能（Imagen 4）
- 部署到GitHub Pages

---

Made with ❤️ using AI Coding
